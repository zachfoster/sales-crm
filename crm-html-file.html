<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18/client';
        import { Plus, Mail, Phone, Search, RefreshCw, Calendar, X, Edit2, Play, Square, Filter } from 'https://esm.sh/lucide-react@0.263.1';

        const SCRIPT_URL = 'https://script.google.com/a/macros/parkviewadvance.com/s/AKfycbymGReDTFOjtNQX1lm_STlYFtx669r-WkQDuLhUydTJOT4E0j1v2j2WZclcbJboLR2a/exec';

        function CRM() {
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [contacts, setContacts] = useState([]);
            const [message, setMessage] = useState('');

            useEffect(() => {
                loadData();
            }, []);

            async function loadData() {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=read&tab=Contacts`);
                    const result = await response.json();
                    if (result.success) {
                        setContacts(result.data);
                        setMessage('âœ… Connected to Google Sheets!');
                    } else {
                        setError('Failed to load data');
                    }
                } catch (err) {
                    setError('Connection error: ' + err.message);
                }
                setLoading(false);
            }

            async function addTestContact() {
                const testContact = {
                    id: Date.now(),
                    name: 'Test Person',
                    company: 'Test Company',
                    email: 'test@example.com',
                    phone: '555-0123',
                    industry: 'Technology',
                    revenue: '1000000',
                    fundingAmount: '50000',
                    stage: 'Cold Lead',
                    lastContact: new Date().toISOString().split('T')[0],
                    notes: 'This is a test contact'
                };

                try {
                    await fetch(`${SCRIPT_URL}?action=write&tab=Contacts`, {
                        method: 'POST',
                        body: JSON.stringify(testContact)
                    });
                    setMessage('âœ… Test contact added! Refreshing...');
                    setTimeout(loadData, 1000);
                } catch (err) {
                    setError('Error adding contact: ' + err.message);
                }
            }

            if (loading) {
                return React.createElement('div', { className: 'min-h-screen flex items-center justify-center' },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement(RefreshCw, { className: 'animate-spin mx-auto mb-4 text-blue-600', size: 48 }),
                        React.createElement('p', { className: 'text-xl text-gray-600' }, 'Connecting to Google Sheets...'),
                        React.createElement('p', { className: 'text-sm text-gray-500 mt-2' }, 'This may take a few seconds')
                    )
                );
            }

            return React.createElement('div', { className: 'max-w-4xl mx-auto p-8' },
                React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-8' },
                    React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, 'ðŸŽ‰ Sales CRM Setup Test'),
                    React.createElement('p', { className: 'text-gray-600 mb-6' }, 'Testing connection to your Google Sheet'),
                    
                    message && React.createElement('div', { className: 'mb-6 p-4 bg-green-50 border border-green-200 rounded-lg' },
                        React.createElement('p', { className: 'text-green-800' }, message)
                    ),
                    
                    error && React.createElement('div', { className: 'mb-6 p-4 bg-red-50 border border-red-200 rounded-lg' },
                        React.createElement('p', { className: 'text-red-800 font-semibold' }, 'Error:'),
                        React.createElement('p', { className: 'text-red-700 text-sm mt-1' }, error),
                        React.createElement('p', { className: 'text-red-600 text-xs mt-2' }, 'Check the browser console (F12) for more details')
                    ),
                    
                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', { className: 'flex items-center justify-between p-4 bg-gray-50 rounded-lg' },
                            React.createElement('div', null,
                                React.createElement('p', { className: 'font-semibold text-gray-900' }, 'Contacts in Sheet:'),
                                React.createElement('p', { className: 'text-2xl font-bold text-blue-600' }, contacts.length)
                            ),
                            React.createElement('button', {
                                onClick: loadData,
                                className: 'flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700'
                            },
                                React.createElement(RefreshCw, { size: 16, className: 'mr-2' }),
                                'Refresh'
                            )
                        ),
                        
                        React.createElement('button', {
                            onClick: addTestContact,
                            className: 'w-full flex items-center justify-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold'
                        },
                            React.createElement(Plus, { size: 20, className: 'mr-2' }),
                            'Add Test Contact'
                        ),
                        
                        contacts.length > 0 && React.createElement('div', { className: 'mt-6' },
                            React.createElement('h3', { className: 'font-semibold text-gray-900 mb-3' }, 'Contacts from Google Sheets:'),
                            React.createElement('div', { className: 'space-y-2' },
                                contacts.map(contact => 
                                    React.createElement('div', { key: contact.id, className: 'p-3 bg-gray-50 rounded border border-gray-200' },
                                        React.createElement('p', { className: 'font-semibold' }, contact.name || 'No name'),
                                        React.createElement('p', { className: 'text-sm text-gray-600' }, contact.company || 'No company'),
                                        React.createElement('p', { className: 'text-xs text-gray-500' }, contact.email || 'No email')
                                    )
                                )
                            )
                        )
                    ),
                    
                    React.createElement('div', { className: 'mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg' },
                        React.createElement('p', { className: 'text-sm text-blue-900 font-semibold mb-2' }, 'âœ“ Setup Steps:'),
                        React.createElement('ol', { className: 'text-sm text-blue-800 space-y-1 list-decimal list-inside' },
                            React.createElement('li', null, 'If you see contacts above, connection works!'),
                            React.createElement('li', null, 'Click "Add Test Contact" to verify write access'),
                            React.createElement('li', null, 'Check your Google Sheet to see the new row'),
                            React.createElement('li', null, 'If everything works, reply "Ready for full CRM"')
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(React.createElement(CRM));
    </script>
</body>
</html>